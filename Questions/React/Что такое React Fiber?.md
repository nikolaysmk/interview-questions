React Fiber – это новая реализация основного алгоритма React, которая была введена в версии 16.0.0. Цель React Fiber – это повысить пригодность React для областей, таких как анимация, верстка и жесты. Его главная особенность – это инкрементальный рендеринг: способность разбивать работу по рендерингу на части и распределять их по нескольким кадрам¹². Другие ключевые особенности включают возможность приостанавливать, отменять или повторно использовать работу при поступлении новых обновлений; возможность назначать приоритет разным типам обновлений; и новые примитивы конкурентности²³.

React Fiber – это переписывание алгоритма согласования React, который отвечает за сравнение деревьев элементов и определение различий между ними. В предыдущей версии React использовался стековый согласователь (stack reconciler), который работал синхронно и не мог быть прерван или приостановлен. Это могло приводить к проблемам с производительностью и отзывчивостью приложения, особенно при большом количестве компонентов или сложной логике рендеринга¹².

React Fiber решает эти проблемы, используя другой подход к согласованию, который называется фибер-согласователь (fiber reconciler). Он работает асинхронно и может быть разбит на небольшие единицы работы, которые выполняются по очереди в соответствии с их приоритетом. Это позволяет React управлять временем выполнения работы и избегать блокировки основного потока JavaScript¹².

React Fiber также вводит новую структуру данных для представления дерева компонентов – фибер-дерево (fiber tree). Каждый узел в этом дереве называется фибер (fiber) и соответствует одному компоненту или элементу. Фибер содержит информацию о типе компонента, его пропсах, состоянии, эффектах и ссылках на другие фиберы – родителя, соседей и потомков. Фибер-дерево является односвязным списком фиберов, который можно легко обходить в разных направлениях¹².

React Fiber использует две фазы для выполнения работы по согласованию: фазу рендера (render phase) и фазу подтверждения (commit phase). В фазе рендера React обходит фибер-дерево и вызывает функции рендеринга компонентов, чтобы получить новые элементы. Затем React сравнивает новые элементы с предыдущими и создает список эффектов – изменений, которые нужно применить к DOM или другому хосту. В этой фазе React может приостанавливать, возобновлять или отменять работу в зависимости от ее приоритета и доступного времени. Это позволяет React уступать место другим задачам, таким как обработка пользовательских событий или анимаций. Фаза рендера не влияет на реальный DOM и может быть прервана без потери состояния .

В фазе подтверждения React применяет список эффектов к DOM или другому хосту. В этой фазе React не может быть прерван, так как это может привести к неконсистентному состоянию интерфейса. Фаза подтверждения также вызывает методы жизненного цикла компонентов, такие как componentDidMount, componentDidUpdate и componentWillUnmount .